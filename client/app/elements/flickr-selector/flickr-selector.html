<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="flickr-square.html">
<dom-module id="flickr-selector">
  <template>
    <style>
    :host {
      display: block;
    }
    
    .drop-place {
      border: 2px dashed grey;
      margin: auto;
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
      min-height: 160px;
    }
    flickr-square {
      margin: 5px 0 5px 5px;
      @apply(--layout-vertical);
      @apply(--layout-center);
      @apply(--layout-flex-1);
    }
    </style>
    <p class="paper-font-subhead">Glisser / DÃ©poser les images flickr ci-dessous</p>
    <div class="drop-place layout horizontal">
      <template is="dom-repeat" items="{{images}}">
        <flickr-square id="{{item.id}}" flickrid="{{item.id}}">
        </flickr-square>
      </template>
    </div>
  </template>
  <script>
  (function() {
    'use strict';
    Polymer({
      is: 'flickr-selector',
      properties: {
        images: {
          type: Array,
          value: []
        }
      },
      listeners: {
        'dragover': 'cancel',
        'dragenter': 'cancel',
        'drop': 'drop'
      },
      ready: function() {
        this.push('images', {
          id: '15861376265'
        });
      },
      cancel: function(e) {
        if (e.preventDefault) {
          e.preventDefault();
        } // required by FF + Safari
        e.dataTransfer.dropEffect = 'copy'; // tells the browser what drop effect is allowed here
        return false; // required by IE
      },
      drop: function(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        var s = e.dataTransfer.getData('Text');
        var re = /https:\/\/www.flickr.com\/photos\/([^\/]*)\/(\d*)/;
        var flickrinfo = re.exec(s);
        this.push('images', {
          id: flickrinfo[2]
        });
      }
    });
  })();
  </script>
</dom-module>
